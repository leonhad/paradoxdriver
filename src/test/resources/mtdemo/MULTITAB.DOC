<INITIAL SETUP>      
          



















           PAL PROGRAMMING WITH MULTI-TABLE FORMS
           --------------------------------------









                     By Brian J. Smith












This material is Copyright 1990 by Brian J. Smith and Associates,
Inc.  Please observe the restrictions stated in the "Readme" file
included with this package.

          


                        INTRODUCTION


These files are a demonstration of PAL programming techniques using
multi-table forms.  Multi-table forms are easy to design using
interactive Paradox.  However, when you try to incorporate them into
a PAL application, the programming can be very complex.
   I have attempted in this package to address many common
multi-table form functional requirements, and illustrate how to
implement those functions in PAL.

   For an explanation of how to print this document and how to
execute the sample programs, refer to the "Readme" file contained
in this package.

   This material is excerpted from the "Advanced PAL" class which is
part of my Paradox/PAL training series.  This series is conducted on
a regular basis in Southern California.  If you would like more
information about this series, please contact:

                Brian J. Smith and Associates, Inc.
                901-A North Pacific Coast Highway
                Suite 200
                Redondo Beach, California 90277
                (213) 374-0151

   These programs were also presented (with a different presentation
document) at the International Paradox Users Conference on May 1,
1990.
   I hope you find this package informative!

                                -- Brian J. Smith
                                   May 30, 1990

          
                     A MULTI-TABLE FORM


<BEGIN COMPRESS>
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±  Coediting Rental table with form F10: Record 3 of 3 (1-M Group)                   ±
±  Entering new record - not yet posted to table                                     ±
±  ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ  VIDEO STORE ORDERS ÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»  ±
±  º                                                                              º  ±
±  º     Date: ® 1/01/89    ¯       Customer # ®1332 ¯                            º  ±
±  º                                                                              º  ±
±  º  ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿  º  ±
±  º  ³  Alfred P. Feller                     415-698-5555                     ³  º  ±
±  º  ³  640 Pacific Heights Blvd.            San Bruno        CA  94061       ³  º  ±
±  º  ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ  º  ±
±  ÌÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍ¹  ±
±  º           ³ Film# ³   Film Title                   ³ Rental Rate ³           º  ±
±  º           ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄ´           º  ±
±  º           ³ B1406 Å The Blob                       Å  $ 1.50     ³           º  ±
±  º           ³ C1204 Å Bachelor & The Bobby-Soxer     Å  $ 2.00     ³           º  ±
±  º           ³ A1003Å                                Å  $          ³           º  ±
±  º           ³       Å                                Å  $          ³           º  ±
±  º           ³       Å                                Å  $          ³           º  ±
±  º           ³       Å                                Å  $          ³           º  ±
±  ÌÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍ¹  ±
±  º                                                    ÚÄÄÄÄÄÄÄÄÄÄÄÄÄ¿           º  ±
±  º                            Total Amount Due ÄÄÄÄÄ> ³ $  3.50     ³           º  ±
±  º                                                    ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÙ           º  ±
±  º                                                                              º  ±
±  ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼  ±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
<END COMPRESS>


                    LINKS BETWEEN FORMS


                    ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
                    º     Vidorder     º
                    º                  º
                    º ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ º
                    º ³   Customer   ³ º
                    º ³     M-1      ³ º
                    º ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ º   PAGE 1
                    º ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ º
                    º ³    Rental    ³ º
                    º ³ Multi-Record ³ º
                    º ³     1-M      ³ º
                    º ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ º
                    ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼


o  VIDORDER is the "master table"

o  CUSTOMER is linked to VIDORDER 
        in a "Many-to-One" (M-1) relationship

        i.e., the same CUSTOMER record can apply
              to many VIDORDER records

              but each VIDORDER record points to
              only one CUSTOMER record

o  RENTAL is linked to VIDORDER
        in a "One-to-Many" (1-M) relationship

        i.e., there can be many RENTAL records
              tied a VIDORDER record,

              but each RENTAL record is tied to
              only one VIDORDER record


               EXAMPLES OF LINK TYPES
                  FORM VIDORDER.F1


<BEGIN COMPRESS>
                    ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
                    º     Vidorder     º
                    º                  º
                    º ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ º
                    º ³   Customer   ³ º
                    º ³     M-1      ³ º
                    º ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ º   PAGE 1
                    º ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ º
                    º ³    Rental    ³ º
                    º ³ Multi-Record ³ º
                    º ³     1-M      ³ º
                    º ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ º
                    º                  º
                    ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
                    º     Vidorder     º
                    º                  º
                    º ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ º   
                    º ³    Films     ³ º   PAGE 2
                    º ³   Unlinked   ³ º
                    º ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ º
                    º                  º
                    ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
                    º     Vidorder     º
                    º                  º
                    º ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ º
                    º ³    Amount    ³ º
                    º ³     1-1      ³ º
                    º ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ º
                    º ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ º   PAGE 3
                    º ³   Payment    ³ º
                    º ³ Multi-Record ³ º
                    º ³     1-M      ³ º
                    º ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ º
                    º ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ º
                    º ³   TaxRate    ³ º
                    º ³   Unlinked   ³ º
                    º ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ º
                    º                  º
                    ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
                    º     Vidorder     º
                    º                  º
                    º ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ º
                    º ³    Store     ³ º
                    º ³ Multi-Record ³ º
                    º ³     M-1      ³ º   PAGE 4
                    º ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ º
                    º ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ º
                    º ³   Employee   ³ º
                    º ³     M-M      ³ º
                    º ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ º
                    º                  º
                    ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼
<END COMPRESS>


o  Exceeds the limit of 5 embedded tables per form.

              HOW PARADOX DETERMINES LINK TYPE



<BEGIN COMPRESS>
                              ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
                              º                    DETAIL TABLE KEY FIELDS                     º
                              ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
                              º   All detail key    ³     Some detail key     ³                º
                              º  fields are linked  ³  fields are not linked  ³  Detail table  º
                              º  to master fields * ³    to master fields **  ³  is not keyed  º
ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÎÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
º          ³  All master      º                     ³                         ³                º
º          ³  table key       º                     ³                         ³                º
º          ³  fields are      º         1-1         ³           1-M           ³                º
º          ³  linked to       º                     ³                         ³                º
º  MASTER  ³  detail fields   º                     ³                         ³    Illegal     º
º  TABLE   ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ×ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´                º
º  KEY     ³  Some master     º                     ³                         ³  (The detail   º
º  FIELDS  ³  table key       º         M-1         ³           M-M           ³  table must    º
º          ³  fields are not  º                     ³                         ³   be keyed)    º
º          ³  part of link    º                     ³                         ³                º
º          ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ×ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´                º
º          ³  Detail fields   º                     ³                         ³                º
º          ³  are linked to   º         M-1         ³           M-M           ³                º
º          ³  non-key master  º                     ³                         ³                º
º          ³  fields ***      º                     ³                         ³                º
º          ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ×ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´                º
º          ³  Master table    º         M-1         ³           M-M           ³                º
º          ³  is unkeyed      º                     ³                         ³                º
ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼
<END COMPRESS>

  * i.e., no key fields appear on the embedded form
 ** i.e., some key fields appear on the embedded form 
          (the rest must be linked to master table fields)
*** other detail fields may be linked to some, but not all,
          master table key fields


                 FORM LOCKS AND LINK LOCKS



<BEGIN COMPRESS>
ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄ¿
³             Link Type            ³ Form Lock?  ³ Link Lock?³
ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄ´
³                                  ³             ³           ³
³  Master table -                  ³             ³           ³
³    - With embedded 1-1 or 1-M    ³    Yes      ³    Yes    ³
³    - With no embedded 1-1 or 1-M ³    No       ³    No     ³
³                                  ³             ³           ³
³  Embedded table with 1-1 link    ³    Yes      ³    Yes    ³
³                                  ³             ³           ³
³  Embedded table with 1-M link    ³    Yes      ³    Yes    ³
³                                  ³             ³           ³
³  Embedded table with M-1 link    ³    No       ³    Yes    ³
³                                  ³             ³           ³
³  Embedded table with M-M link    ³    No       ³    Yes    ³
³                                  ³             ³           ³
³  Unlinked embedded table         ³    No       ³    No     ³
³                                  ³             ³           ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÙ
<END COMPRESS>

Form locks are placed on a table:

o  During Co-Edit or data entry session

o  When using multi-table forms


Link locks are placed on a table:

o  In Co-Edit mode or in a multi-table form





                  A FORM LOCK WORK-AROUND



The problem:  When you use a multi-table form,
              you prevent other users from editing
              the same tables with other forms,
              or in table view.



The work-around:  "Shadow" master table


   -  Table with the same structure as the master,
      with the same multi-table form, but unkeyed

   -  Use COPYTOARRAY and COPYFROMARRAY to transfer
      a record between the original master and the
      "shadow."



Demonstration of "shadow tables":   FORM5.SC



                   LINK LOCK WORK-AROUNDS



The problem:  When you are on a locked record in
              a multi-table form, Paradox will not
              let you press [F7] to depart from the
              form before unlocking.


o  Alternative #1:

   Move to another embedded table in which the record
   is not locked.



o  Alternative #2:

   Embed tables you must move to into the form,
   as "unlinked" tables.  Maybe make them invisible.



Demonstrations of Alternative #2:
        FORM4.SC  (Films table and TaxRate table)


                      BASIC TECHNIQUES
                      FORM VIDORDER.F2



<BEGIN COMPRESS>
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±  Add or edit rental line items                                                     ±
±  Press [F2] when done, [F3] to return to master                                    ±
±  ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ  VIDEO STORE ORDERS ÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»  ±
±  º                                                                              º  ±
±  º     Date: ® 5/01/90    ¯       Customer # ®1776 ¯                            º  ±
±  º     Time: ®10:15A ¯               Store # ®A  ¯                              º  ±
±  º  ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿  º  ±
±  º  ³  Elizabeth Wawrzyczek                 415-359-1992                     ³  º  ±
±  º  ³  669 Aquarius Lane                    Foster City      CA  94404       ³  º  ±
±  º  ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ  º  ±
±  ÌÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍ¹  ±
±  º           ³ Film# ³   Film Title                   ³ Rental Rate ³           º  ±
±  º           ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄ´           º  ±
±  º           ³ A1010 Å Back To The Future             Å  $ 3.00     ³           º  ±
±  º           ³ B1217 Å Casablanca                     Å  $ 2.00     ³           º  ±
±  º           ³ C1210 Å North By Northwest             Å  $ 2.00     ³           º  ±
±  º           ³ A1012Å                                Å  $          ³           º  ±
±  º           ³       Å                                Å  $          ³           º  ±
±  º           ³       Å                                Å  $          ³           º  ±
±  ÌÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍ¹  ±
±  º                                                    ÚÄÄÄÄÄÄÄÄÄÄÄÄÄ¿           º  ±
±  º                            Total Amount Due ÄÄÄÄÄ> ³ $  7.00     ³           º  ±
±  º                                                    ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÙ           º  ±
±  º                                                                              º  ±
±  ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼  ±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
<END COMPRESS>

Techniques to demonstrate:

o  Summing a column in the multi-record form,
   and displaying the total in the master form.

o  Avoiding duplicate keys in the multi-record form.


                      BASIC TECHNIQUES
                        (Continued)



                    ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
                    º     Vidorder     º
                    º                  º
                    º ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ º
                    º ³   Customer   ³ º
                    º ³     M-1      ³ º
                    º ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ º   PAGE 1
                    º ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ º
                    º ³    Rental    ³ º
                    º ³ Multi-Record ³ º
                    º ³     1-M      ³ º
                    º ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ º
                    ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼



<BEGIN COMPRESS>
ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  The structure of VIDORDER.DB:  ³
ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  STRUCTÍËÍÍÍÍÍÍÍÍÍField NameÍÍÍÍÍÍÍÍÍËField Type»  ³
³       1 º  Date                      º  D*      º  ³
³       2 º  Customer #                º  A4*     º  ³
³       3 º  Time                      º  A6      º  ³
³       4 º  Store #                   º  A2      º  ³
³       5 º  Store State               º  A2      º  ³
³       6 º  Customer State            º  A2      º  ³
³       7 º  Total Amount Due          º  $       º  ³
³       8 º  Sales Tax Rate            º  N       º  ³
³       9 º  Dummy 2                   º  A1      º  ³
³      10 º  Dummy 3                   º  A1      º  ³
³      11 º  Dummy 4                   º  A1      º  ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ


ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  The structure of RENTAL.DB:  ³
ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  STRUCTÍËÍÍÍÍÍÍÍÍÍField NameÍÍÍÍÍÍÍÍÍËField Type»  ³
³       1 º  Date                      º  D*      º  ³
³       2 º  Customer #                º  A4*     º  ³
³       3 º  Film #                    º  A5*     º  ³
³       4 º  Film Title                º  A30     º  ³
³       5 º  Rental Fee                º  $       º  ³
³       6 º  Category                  º  A9      º  ³
³       7 º  City                      º  A15     º  ³
³       8 º  Date Returned             º  D       º  ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
<END COMPRESS>

                      SUMMING A COLUMN

<BEGIN COMPRESS>
ÚÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  Form2.Sc  ³  Proc Form2_Master()
ÃÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³                                                                                   ³
³  94  ;  Add up the current amount                                                 ³
³  95                                                                               ³
³  96  If is_inserting then                ;this is a new record                    ³
³  97     total_amt = 0                    ;so its amount starts out 0              ³
³  98  Else                                ;we're editing a record                  ³
³  99     MoveTo "Rental"                  ;switch to the rental form               ³
³ 100     MoveTo [Rental Fee]              ;switch to the field to add up           ³
³ 101     total_amt = imagecsum()          ;add up this column                      ³
³ 102     MoveTo "Vidorder"                ;return to the master form               ³
³ 103     [Total Amount Due] = total_amt   ;initialize the field                    ³
³ 104  Endif                                                                        ³
³                                                                                   ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
<END COMPRESS>

This code is executed when you first enter the
Vidorder record for the first time, just before
the first WAIT RECORD on the master table.


Variable "TOTAL_AMT" -- Contains the total amount of the
    [Rental Fee] column of the RENTAL records.
    The script will keep this variable up-to-date and
    write it into the [Total Amount Due] field in the
    VIDORDER record whenever it changes.
                        

Lines 96-97:  If we're inserting a new VIDORDER (master)
              record, then we know total_amt=0.

Lines 98-103:  If we're viewing an existing VIDORDER
               record, then we re-calculate total_amt
               from scratch using the IMAGECSUM() function.

Alternative:  We could use a SCAN loop instead of 
              IMAGECSUM() to calculate total_amt.

Alternative:  We could assume that [Total Amount Due]
              is accurate, and get total_amt from there,
              instead of re-calculating it.


                      SUMMING A COLUMN
                        (Continued)

<BEGIN COMPRESS>
ÚÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  Form2.Sc  ³  Proc Form2_Rental()
ÃÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³                                                                                   ³
³ 218        change_amt = -[Rental Fee]          ;remember original fee on this line³
³                                                                                   ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
<END COMPRESS>

This code is executed when we arrive at a new RENTAL
record, just before the WAIT RECORD.

Variable "CHANGE_AMT" -- Contains the amount by which
   we need to adjust the "total_amt," based on the
   editing we've done to one RENTAL record.

        change_amt = (rental fee after editing)
                        - (rental fee before editing)

Line 218 -- This sets the "minus" component of change_amt,
            i.e., the value of [Rental Fee] before we
            begin editing a record.
               If we're inserting a new record, this will
            be zero.


                      SUMMING A COLUMN
                        (Continued)


<BEGIN COMPRESS>
ÚÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  Form2.Sc  ³  Proc Form2_Rental()
ÃÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³                                                                                   ³
³ 282     If is_del_key then            ;we're deleting a record                    ³
³ 286        Del                        ;delete the record                          ³
³ 299     Else                                                                      ³
³ 300        change_amt = change_amt + [Rental Fee]   ;change the total             ³
³ 303     Endif                                                                     ³
³                                                                                   ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
<END COMPRESS>

This code is executed when we are about to depart from
a RENTAL record, after the WAIT RECORD.

Line 300 -- This sets the "plus" component of change_amt,
            i.e., the value of [Rental Fee] after we
            finish editing a record.
               If we're deleting a record, this code is
            bypassed, owing to the "IF" on line 282.


                      SUMMING A COLUMN
                        (Continued)

<BEGIN COMPRESS>
ÚÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  Form2.Sc  ³  Proc Form2_Rental()
ÃÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³                                                                                   ³
³ 305  ;  Update the amount total, and prepare for a new record                     ³
³ 306                                                                               ³
³ 307     If change_amt<>0 then                     ;there has been a change        ³
³ 308        total_amt = total_amt + change_amt     ;new amount                     ³
³ 309        MoveTo "Vidorder"                      ;switch to the master record    ³
³ 310        [Total Amount Due] = total_amt         ;update master record           ³
³ 311        MoveTo "Rental"                        ;return to detail record        ³
³ 312     Endif                                                                     ³
³                                                                                   ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
<END COMPRESS>

This code is executed when we are about to depart from
a RENTAL record, after the WAIT RECORD.

Line 307 -- This code would work just fine even without
            the IF...ENDIF, but if the [Rental Fee]      
            hasn't changed, it's faster if we bypass
            lines 308-311.

Line 308 -- This updates the "total_amt" variable.

Lines 309-311 -- This updates the [Total Amount Due] field.
                 The user will see the new total when the
                 next WAIT is executed.

Alternative:  We could recalculate the total amount by
              using the IMAGECSUM() function.  This has
              two disadvantages:

              o  If there are many RENTAL records, the
                 IMAGECSUM() function is slow.

              o  If the [Rental Fee] column is display-only
                 then you cannot use IMAGECSUM() on it.
                 To use IMAGECSUM(), you must be able to
                 move the cursor to the field first.


                  AVOIDING DUPLICATE KEYS

<BEGIN COMPRESS>
ÚÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  Form2.Sc  ³  Proc Form2_Rental()
ÃÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³                                                                                   ³
³ 215              ImageRights Update            ;don't let the user change the key ³
³                                                                                   ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
<END COMPRESS>


This code is executed when we arrive at an existing RENTAL
record, just before the WAIT RECORD.       

Line 215 -- If we're about to edit an existing RENTAL
            record, we avoid a duplicate key by simply
            not letting the user change the key.  The
            IMAGERIGHTS UPDATE command accomplishes this.


                  AVOIDING DUPLICATE KEYS
                        (Continued)

<BEGIN COMPRESS>
ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  Common.Sc    ³  Proc Post_New_Rental()
ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³                                                                                   ³
³ 230  Proc Post_New_Rental()                                                       ³
³ 231                                                                               ³
³ 232  ;  When the user has entered a new record into the Rental table,             ³
³ 233  ;  this procedure validates it and attempts to lock it.                      ³
³ 234                                                                               ³
³ 235  ;  Make sure the key field is filled in                                      ³
³ 236                                                                               ³
³ 237  If isblank([Film #]) then           ;it's blank                              ³
³ 238     is_del_key = True                ;delete the record                       ³
³ 239     Return                                                                    ³
³ 240  Endif                                                                        ³
³ 241                                                                               ³
³ 242  ;  Attempt to lock the record.                                               ³
³ 243  ;  Assume that failure to lock it means a key violation.                     ³
³ 244                                                                               ³
³ 245  LockRecord           ;attempt to post the record                             ³
³ 246  If not retval then   ;we were unable to lock it                              ³
³ 247     Beep                                                                      ³
³ 248     MoveTo [Film #]                                                           ³
³ 249     [] = []           ;return to unposted state                               ³
³ 250     wait_msg = "This film record already exists in this order"                ³
³ 251     Return                                                                    ³
³ 252  Endif                                                                        ³
³ 253                                                                               ³
³ 254  ;  The record has been successfully locked                                   ³
³ 255                                                                               ³
³ 256  is_locked_detail = True       ;the record is now locked                      ³
³ 257  ImageRights Update            ;don't let the user change the key anymore     ³
³ 258                                                                               ³
³ 259  ;  All done                                                                  ³
³ 260                                                                               ³
³ 261  EndProc                                                                      ³
³                                                                                   ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
<END COMPRESS>

This procedure is called when we are about to depart from
a new RENTAL record, after the WAIT RECORD.
This procedure is called only when:

   o  We are inserting a new record, not updating an 
         existing one, and
   o  We have not executed this procedure successfully
         before for this record;  i.e., the new record is 
         not yet locked.

                  AVOIDING DUPLICATE KEYS
                        (Continued)


Lines 237-240 -- If the user left the film # blank, we'll
                 delete the record for them.  (The variable
                 "is_del_key" is also set when the user
                 presses [Del] to delete the record.)

Line 245 -- The LOCKRECORD command is the most efficient
            way to test for a duplicate key during data
            entry.

Line 246 -- If LOCKRECORD returns retval=False, then the
            record could not be inserted to the table.
            This is almost certainly a duplicate key.

Line 249 -- This critical command []=[] reverts the record
            from its "duplicate key" status back to its
            "newly inserted" status.  Without this command,
            the LOCKRECORD on the next go-round might cause
            the other record with the same key to be erased
            and replaced with this new one.

Line 256 -- The "is_locked_detail" flag will prevent this
            procedure from being called again for this
            record.

Line 257 -- The IMAGERIGHTS UPDATE command prevents the
            user from changing the key on this record
            from now on -- otherwise, we'd have to worry
            about more duplicate key problems.


                CONSECUTIVE RECORD NUMBERING
                      FORM VIDORDER.F3



<BEGIN COMPRESS>
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±  Add or edit rental line items                                                     ±
±  Press [F2] when done, [F3] to return to master                                    ±
±  ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ  VIDEO STORE ORDERS ÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»  ±
±  º                                                                              º  ±
±  º     Date: ® 5/02/90    ¯       Customer # ®1776 ¯                            º  ±
±  º     Time: ®10:15A ¯               Store # ®A  ¯                              º  ±
±  º  ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿  º  ±
±  º  ³  Elizabeth Wawrzyczek                 415-359-1992                     ³  º  ±
±  º  ³  669 Aquarius Lane                    Foster City      CA  94404       ³  º  ±
±  º  ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ  º  ±
±  ÌÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍ¹  ±
±  º      ³  Line#  ³ Film# ³   Film Title                   ³ Rental Rate ³      º  ±
±  º      ÃÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄ´      º  ±
±  º      ³   1     Å A1010 Å Back To The Future             Å  $ 3.00     ³      º  ±
±  º      ³   2     Å B1217 Å Casablanca                     Å  $ 2.00     ³      º  ±
±  º      ³   3     Å C1210 Å North By Northwest             Å  $ 2.00     ³      º  ±
±  º      ³         Å A1012Å                                Å  $          ³      º  ±
±  º      ³         Å       Å                                Å  $          ³      º  ±
±  º      ³         Å       Å                                Å  $          ³      º  ±
±  ÌÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍ¹  ±
±  º                                                                              º  ±
±  º                                                                              º  ±
±  º                                                                              º  ±
±  º                                                                              º  ±
±  ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼  ±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
<END COMPRESS>

Note:  The [Line #] field is a display-only field.

Technique to demonstrate:

o  Automatically assigning a value to the "Line #"
   field in the multi-record form, so that each
   record has a different line number.


Alternative:  Although Paradox requires that the [Line #]
              field be placed on the form, there is no
              reason why the user has to be able to see it.
              You can make the field invisible by coloring
              it with an "invisible" color combination,
              such as Blue on Blue.


                CONSECUTIVE RECORD NUMBERING
                        (Continued)



                    ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
                    º     Vidorder     º
                    º                  º
                    º ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ º
                    º ³   Customer   ³ º
                    º ³     M-1      ³ º
                    º ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ º   PAGE 1
                    º ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ º
                    º ³   KRental    ³ º
                    º ³ Multi-Record ³ º
                    º ³     1-M      ³ º
                    º ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ º
                    ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼


ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  The structure of KRENTAL.DB:  ³
ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  STRUCTÍËÍÍÍÍÍÍÍÍÍField NameÍÍÍÍÍÍÍÍÍËField Type»  ³                              
³       1 º  Date                      º  D*      º  ³                              
³       2 º  Customer #                º  A4*     º  ³                              
³       3 º  Line #                    º  N*      º  ³                              
³       4 º  Film #                    º  A5      º  ³                              
³       5 º  Film Title                º  A30     º  ³                              
³       6 º  Rental Fee                º  $       º  ³                              
³       7 º  Category                  º  A9      º  ³                              
³       8 º  City                      º  A15     º  ³                              
³       9 º  Date Returned             º  D       º  ³                              
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ


              CALCULATING THE NEXT LINE NUMBER

<BEGIN COMPRESS>
ÚÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  Form3.Sc  ³   Proc Form3_Master()
ÃÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³                                                                                   ³
³  94  ;  Find out the highest line #                                               ³
³  95                                                                               ³
³  96  If is_inserting then                ;this is a new record                    ³
³  97     high_line = 0                    ;so its line numbering starts out 0      ³
³  98  Else                                ;we're editing a record                  ³
³  99     MoveTo "KRental"                 ;switch to the rental form               ³
³ 100     End                              ;jump to the last record                 ³
³ 101     high_line = [Line #]             ;get the highest line #                  ³
³ 102     Home                             ;return to the first record              ³
³ 103     MoveTo "Vidorder"                ;return to the master form               ³
³ 104  Endif                                                                        ³
³                                                                                   ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
<END COMPRESS>

This code is executed when you first enter the
Vidorder record for the first time, just before
the first WAIT RECORD on the master table.


Variable "HIGH_LINE" -- Contains the highest line number
    assigned to any of the KRENTAL records so far.
    The script will keep this variable up-to-date and
    write it into the [Line #] field of any new KRENTAL
    records that are created.
                        

Lines 96-97:  If we're inserting a new VIDORDER (master)
              record, then we know no line numbers have
              been assigned yet.  Therefore, we start out
              with high_line=0.

Line 100:  We jump to the last KRENTAL record for this
           order.  We know we'll find the highest existing
           line number here.

Line 101:  This gets the highest existing line # and saves
           it for later use.


              CALCULATING THE NEXT LINE NUMBER
                        (Continued)



<BEGIN COMPRESS>
ÚÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  Form3.Sc  ³   Proc Post_New_KRental()
ÃÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³                                                                                   ³
³ 377  high_line = high_line + 1        ;increment the line counter                 ³
³ 378  [Line #] = high_line             ;insert the line counter                    ³
³                                                                                   ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
<END COMPRESS>

This code is executed when we are about to depart from
a new RENTAL record, after the WAIT RECORD.
This code is in the POST_NEW_KRENTAL() procedure, which is
called only when:

   o  We are inserting a new record, not updating an 
         existing one, and
   o  We have not executed this procedure successfully
         before for this record;  i.e., the new record is 
         not yet locked.


Line 377 -- This increments our line counter variable,
            "high_line", by 1.

Line 378 -- This inserts the new line number into the
            new KRENTAL record.



                SEQUENTIAL RECORD NUMBERING
                      FORM VIDORDER.F3


<BEGIN COMPRESS>
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±  Add or edit rental line items                                                     ±
±  Press [F2] when done, [F3] to return to master                                    ±
±  ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ  VIDEO STORE ORDERS ÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»  ±
±  º                                                                              º  ±
±  º     Date: ® 5/03/90    ¯       Customer # ®1776 ¯                            º  ±
±  º     Time: ®10:15A ¯               Store # ®A  ¯                              º  ±
±  º  ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿  º  ±
±  º  ³  Elizabeth Wawrzyczek                 415-359-1992                     ³  º  ±
±  º  ³  669 Aquarius Lane                    Foster City      CA  94404       ³  º  ±
±  º  ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ  º  ±
±  ÌÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍ¹  ±
±  º      ³  Line#  ³ Film# ³   Film Title                   ³ Rental Rate ³      º  ±
±  º      ÃÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄ´      º  ±
±  º      ³   1     Å A1010 Å Back To The Future             Å  $ 3.00     ³      º  ±
±  º      ³         Å A1012Å                                Å  $          ³      º  ±
±  º      ³   1.5   Å B1217 Å Casablanca                     Å  $ 2.00     ³      º  ±
±  º      ³   2     Å C1210 Å North By Northwest             Å  $ 2.00     ³      º  ±
±  º      ³         Å       Å                                Å  $          ³      º  ±
±  º      ³         Å       Å                                Å  $          ³      º  ±
±  ÌÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍ¹  ±
±  º                                                                              º  ±
±  º                                                                              º  ±
±  º                                                                              º  ±
±  º                                                                              º  ±
±  ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼  ±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
<END COMPRESS>


Note:  The [Line #] field is a display-only field.

Technique to demonstrate:

o  Automatically assigning a value to the "Line #"
   field in the multi-record form, so that each
   record has a different line number.

o  This procedure allows you to "insert" a new line
   in between two existing lines, by assigning a 
   line # which is midway between the lines above
   and below.



                SEQUENTIAL RECORD NUMBERING
                        (Continued)



                    ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
                    º     Vidorder     º
                    º                  º
                    º ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ º
                    º ³   Customer   ³ º
                    º ³     M-1      ³ º
                    º ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ º   PAGE 1
                    º ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ º
                    º ³   KRental    ³ º
                    º ³ Multi-Record ³ º
                    º ³     1-M      ³ º
                    º ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ º
                    ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼


   
ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  The structure of KRENTAL.DB:  ³
ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  STRUCTÍËÍÍÍÍÍÍÍÍÍField NameÍÍÍÍÍÍÍÍÍËField Type»  ³
³       1 º  Date                      º  D*      º  ³
³       2 º  Customer #                º  A4*     º  ³
³       3 º  Line #                    º  N*      º  ³
³       4 º  Film #                    º  A5      º  ³
³       5 º  Film Title                º  A30     º  ³
³       6 º  Rental Fee                º  $       º  ³
³       7 º  Category                  º  A9      º  ³
³       8 º  City                      º  A15     º  ³
³       9 º  Date Returned             º  D       º  ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

          CALCULATING THE "IN-BETWEEN" LINE NUMBER


Case #1:  We press the [Ins] key between two existing
          records.

Case #2:  We press the [Ins] key from the first line
          in the form.

<BEGIN COMPRESS>
ÚÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  Form3i.Sc  ³  Proc Form3i_Rental()
ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³                                                                                   ³
³ 308  ;  Calculate the line # for a new record                                     ³
³ 309                                                                               ³
³ 310        If is_ins_key then               ;we're about to insert a record       ³
³ 311           below_line = [Line #]         ;remember the current line #          ³
³ 312           If atfirst() then             ;we're at the first record            ³
³ 313              Switch                                                           ³
³ 314                 Case below_line>1.01: ;there's room for positive integer      ³
³ 315                    between_line = int(below_line-1)  ;use a number one less   ³
³ 316                 Case below_line>0:    ;we can squeeze in a small fraction     ³
³ 317                    between_line = below_line*0.5                              ³
³ 318                 Otherwise:              ;it's zero or negative                ³
³ 319                    between_line = below_line - 1                              ³
³ 320              EndSwitch                                                        ³
³ 321           Else                          ;we're not at the first record        ³
³ 322              Skip -1                    ;move to the line above               ³
³ 323              above_line = [Line #]      ;the line # from above                ³
³ 324              Skip 1                     ;move back to the line below          ³
³ 325              between_line = (below_line+above_line)*0.5   ;take the average   ³
³ 326           Endif                                                               ³
³ 327        Endif                                                                  ³
³ 328     Endif                                                                     ³
³                                                                                   ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
<END COMPRESS>

This code is executed when you have pressed the
[Ins] key to depart from a KRENTAL record, after
the WAIT RECORD.

          CALCULATING THE "IN-BETWEEN" LINE NUMBER
                        (Continued)


Variable "BETWEEN_LINE" -- Contains the new line #
    which the program calculates for a record when
    the user presses the [Ins] key.
       In the typical case, "BETWEEN_LINE" is calculated
    as the average of "ABOVE_LINE" and "BELOW_LINE."

Variables "ABOVE_LINE" and "BELOW_LINE" -- The line #'s
   of the existing records above and below where we are
   inserting a new record.


Line 310 -- This code segment is performed only when
            the user has pressed the [Ins] key, which
            sets is_ins_key=True.

Line 311 -- Since we are about to execute the INS command,
            the line we are currently sitting on will
            become the line below where the new line will
            be inserted.  Therefore, capture its line #
            in the "between_line" variable.

Line 312 -- There are two basic situations:

            (1)  We press the [Ins] key between two
                 existing records, or

            (2)  We press the [Ins] key from the first
                 line in the form.

            The ATFIRST() function tells us which is the
            case.

Lines 313-320 -- If we're inserting a new line above the
                 highest line, we will attempt to assign
                 a positive number to the new line, but
                 we may have to resort to a negative one.

Lines 322-325 -- If we're inserting a new line between two
                 existing lines, travel up to the line
                 above to capture its line # in the
                 "above_line" variable.  Calculate
                 "between_line" as the average of
                 "below_line" and "above_line."


          CALCULATING THE "IN-BETWEEN" LINE NUMBER
                        (Continued)


Case #3:  We press the [Down] key to add a new record
          below the lowest existing line.

<BEGIN COMPRESS>
ÚÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  Form3i.Sc  ³  Proc Form3i_Rental()
ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³                                                                                   ³
³ 341        If is_ins_down then        ;we'll press down fromt he last record      ³
³ 342           between_line = int([Line #]+1)   ;so increment line # by 1          ³
³ 343        Endif                                                                  ³
³ 344        KeyPress wait_key          ;perform the function                       ³
³                                                                                   ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
<END COMPRESS>

This code is executed when you have pressed the
[Down] key to depart from the last KRENTAL record,
after the WAIT RECORD, 


Line 341 -- The "is_ins_down" variable will be True if the
            user has pressed the [Down] key from the lowest
            line on the form; in other words, to add a new
            line at the bottom.

Line 342 -- The "between_line" variable will become the
            line # for the new record.  It is one more than
            the line # of the record we are departing from.
            We use the INT() function to eliminate any
            fraction.

Line 344 -- This presses the [Down] key, thereby opening
            up the new record.


          CALCULATING THE "IN-BETWEEN" LINE NUMBER
                        (Continued)


Case #4:  We move to the KRENTAL table for the first 
          time and find that the table is empty.  We
          are about to add the first record to it.

<BEGIN COMPRESS>
ÚÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  Form3i.Sc  ³  Proc Is_New_KRental_I()
ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³                                                                                   ³
³ 383     between_line = 1                 ;assign #1 to the first line             ³
³                                                                                   ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
<END COMPRESS>

This code is executed when you enter the KRENTAL
table for the first time, before the first WAIT RECORD.
it is executed only if the program determines that there
are no KRENTAL records there yet.


Line 383 -- Since we're about to add the first record for
            this VIDORDER master, it's line # will be 1.



          CALCULATING THE "IN-BETWEEN" LINE NUMBER
                        (Continued)


Case #5:  When we delete and then insert a record at the 
          same spot, we can re-use the line # from the
          deleted record in the new record.

<BEGIN COMPRESS>
ÚÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  Form3i.Sc  ³  Proc Form3i_Rental()
ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³                                                                                   ³
³ 279     If is_del_key then            ;we're deleting a record                    ³
³ 283                                                                               ³
³ 284  ;  If we re-insert a line at the same place we delete one,                   ³
³ 285  ;  we'll give the same line # as the deleted record                          ³
³ 286                                                                               ³
³ 287        If not isblank([Line #]) then    ;this record has a line #             ³
³ 288           between_line = [Line #]       ;so save it for re-use                ³
³ 289        Endif                                                                  ³
³ 290                                                                               ³
³ 291        Del                              ;delete the record                    ³
³                                                                                   ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
<END COMPRESS>

This code is executed when you have pressed the
[Del] key to depart from a KRENTAL record, after
the WAIT RECORD.


          CALCULATING THE "IN-BETWEEN" LINE NUMBER
                        (Continued)


Filling the "between_line" value into a new record:

<BEGIN COMPRESS>
ÚÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  Form3i.Sc  ³  Proc Post_New_KRental_I()
ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³                                                                                   ³
³ 407  ;  Assign the next available key to the new record                           ³
³ 408                                                                               ³
³ 409  [Line #] = between_line             ;place the line number into the record   ³
³                                                                                   ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
<END COMPRESS>

This code is executed when we are about to depart from
a new RENTAL record, after the WAIT RECORD.
This code is in the POST_NEW_KRENTAL() procedure, which is
called only when:

   o  We are inserting a new record, not updating an 
         existing one, and
   o  We have not executed this procedure successfully
         before for this record;  i.e., the new record is 
         not yet locked.

     
Line 409 -- The "between_line" variable was calculated
            during the previous WAIT RECORD loop.  Now that
            the user has filled in their part of the new
            record, we're ready to store the line # we've
            calculated into it.            

                    USING UNLINKED TABLES
                      FORM VIDORDER.F4

<BEGIN COMPRESS>
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±  Add or edit rental line items                                                     ±
±  Press [F2] when done, [F3] to return to master, [F4] to see films                 ±
±  ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ  VIDEO STORE ORDERS ÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»  ±
±  º                                                                              º  ±
±  º     Date: ® 5/04/90    ¯       Customer # ®1776 ¯                            º  ±
±  º     Time: ®10:15A ¯               Store # ®A  ¯                              º  ±
±  º  ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿  º  ±
±  º  ³  Elizabeth Wawrzyczek                 415-359-1992                     ³  º  ±
±  º  ³  669 Aquarius Lane                    Foster City      CA  94404       ³  º  ±
±  º  ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ  º  ±
±  ÌÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍ¹  ±
±  º           ³ Film# ³   Film Title                   ³ Rental Rate ³           º  ±
±  º           ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄ´           º  ±
±  º           ³ A1010 Å Back To The Future             Å  $ 3.00     ³           º  ±
±  º           ³ B1217 Å Casablanca                     Å  $ 2.00     ³           º  ±
±  º           ³ C1210Å North By Northwest             Å  $ 2.00     ³           º  ±
±  º           ³       Å                                Å  $          ³           º  ±
±  º           ³       Å                                Å  $          ³           º  ±
±  º           ³       Å                                Å  $          ³           º  ±
±  ÌÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍ¹  ±
±  º                                                    ÚÄÄÄÄÄÄÄÄÄÄÄÄÄ¿           º  ±
±  º                            Total Amount Due ÄÄÄÄÄ> ³ $  5.00     ³           º  ±
±  º                                                    ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÙ           º  ±
±  º Store State: ®CA ¯  Customer State: ®CA ¯   Sales Tax Rate: ®  6.5   %¯   C  º  ±
±  º                                                                              º  ±
±  º                                            ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿  ±
±  º                                            ³  Film # C1210 is out of stock!  ³  ±
±  ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ  ±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±


±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±  View and edit the films inventory                                                 ±
±  Press [F3] to return to the Rental form                                           ±
±  ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ  VIDEO STORE ORDERS ÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»  ±
±  º                                                                              º  ±
±  º     Date: ® 5/04/90    ¯       Customer # ®1776 ¯                            º  ±
±  º  ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»  º  ±
±  º  º                            FILMS INVENTORY                             º  º  ±
±  º  ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹  º  ±
±  º  º Film #/Title: C1207 /Airplane II: The Sequel        # of Copies:    10 º  º  ±
±  º  º  Year/Actors: 1982  /R.Hayes,L.Bridges              # in Stock:     10 º  º  ±
±  º  º     Category: Comedy      Rating: PG                Rental Fee: 3.00   º  º  ±
±  º  ºÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶  º  ±
±  º  º Film #/Title: C1208 /Superman III                   # of Copies:    10 º  º  ±
±  º  º  Year/Actors: 1983  /C.Reeve,R.Pryor                # in Stock:     10 º  º  ±
±  º  º     Category: Adventure   Rating: PG                Rental Fee: 3.00   º  º  ±
±  º  ºÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶  º  ±
±  º  º Film #/Title: C1210/North By Northwest             # of Copies:    10 º  º  ±
±  º  º  Year/Actors: 1959  /C.Grant,Hitchcock(D)           # in Stock:      0 º  º  ±
±  º  º     Category: Adventure   Rating: G                 Rental Fee: 2.00   º  º  ±
±  º  ºÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶  º  ±
±  º  º Film #/Title: C1211 /Taxi Driver                    # of Copies:    10 º  º  ±
±  º  º  Year/Actors: 1982  /R.DeNiro,C.Shepard             # in Stock:     10 º  º  ±
±  º  º     Category: Drama       Rating: PG                Rental Fee: 2.50   º  º  ±
±  º  ºÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶  º  ±
±  ÈÍÍÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼ÍÍ¼  ±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
<END COMPRESS>

                   USING UNLINKED TABLES
                        (Continued)



Techniques to demonstrate:

o  Allow the user to toggle to back and forth to the FILMS
   table using the [F4] and [F3] keys.
      The FILMS table is an "unlinked" form, so the user
   can scroll through it and view any record they choose.
   In addition, we'll allow them to edit the FILMS table.
   Thus, they could add a new FILMS record then return and
   add that film to the order.

o  Have the script keep track of the # of films in stock.
   The script does this by locating the FILMS record
   whenever the user adds a record to the RENTAL table or
   deletes a record.  The script decrements the
   [# in Stock] field for the film by one when a RENTAL
   record is added, and increments the field by one when a
   record is deleted.

o  Calculate the sales tax, a field in the VIDORDER table,
   by looking it up in the TAXRATE table.  The TAXRATE
   table has a two-field key.
      The TAXRATE table is an "invisible" embedded form.




                   USING UNLINKED TABLES
                        (Continued)


                    ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
                    º     Vidorder     º
                    º                  º
                    º ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ º
                    º ³   Customer   ³ º
                    º ³     M-1      ³ º
                    º ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ º   PAGE 1
                    º ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ º
                    º ³    Rental    ³ º
                    º ³ Multi-Record ³ º
                    º ³     1-M      ³ º
                    º ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ º
                    º ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ º
                    º ³   TaxRate    ³ º
                    º ³   Unlinked   ³ º
                    º ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ º
                    ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
                    º     Vidorder     º
                    º                  º
                    º ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ º   
                    º ³    Films     ³ º   PAGE 2
                    º ³   Unlinked   ³ º
                    º ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ º
                    º                  º
                    ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼


ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  How to make the TAXRATE form "invisible":          ³
ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³  1.  Design a new form, form F10 for TAXRATE.       ³
³                                                     ³
³  2.  Place only one field, such as [Store State],   ³
³      on the form.  Place it in the upper left       ³
³      corner of the form.  (It doesn't matter which  ³
³      field.)                                        ³
³                                                     ³
³  3.  Reformat the field to shrink it to one         ³
³      character wide.                                ³
³                                                     ³
³  4.  Use Style/Color/Area to paint the field        ³
³      "invisible," say Blue on Blue.                 ³
³                                                     ³
³  5.  Save the form, then embed it onto the          ³
³      VIDORDER form (anywhere on it).                ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

                   USING UNLINKED TABLES
                        (Continued)






ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  The structure of FILMS.DB:  ³
ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  STRUCTÍËÍÍÍÍÍÍÍÍÍField NameÍÍÍÍÍÍÍÍÍËField Type»  ³                               ±
³       1 º  Film #                    º  A5*     º  ³
³       2 º  Film Title                º  A30     º  ³
³       3 º  # in Stock                º  S       º  ³
³       4 º  Actors                    º  A20     º  ³
³       5 º  Category                  º  A9      º  ³
³       6 º  Year                      º  N       º  ³
³       7 º  Rating                    º  A2      º  ³
³       8 º  Rental Fee                º  $       º  ³
³       9 º  # of Copies               º  S       º  ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ


ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  The structure of TAXRATE.DB:  ³
ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  STRUCTÍËÍÍÍÍÍÍÍÍÍField NameÍÍÍÍÍÍÍÍÍËField Type»  ³                               ±
³       1 º  Store State               º  A2*     º  ³
³       2 º  Customer State            º  A2*     º  ³
³       3 º  Sales Tax Rate            º  N       º  ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

               THE BENEFIT OF UNLINKED TABLES


Instead of embedding FILMS and TAXRATE forms on the master
form, you could write your PAL script to temporarily exit
from the VIDORDER form, and visit these tables elsewhere
on the workspace.

However, it is slow to bring switch between a multi-table 
form and table-view.

By embedding the forms onto the VIDORDER form, you can
switch to those tables instantaneously.


                SWITCHING TO THE FILMS FORM


<BEGIN COMPRESS>
ÚÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  Form4.Sc  ³   Proc Form4_Rental()
ÃÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³                                                                                    ³
³ 335        If wait_key="F4" then      ;[F4] means display films                    ³
³ 336           Form4_Films()           ;so display them                             ³
³                                                                                    ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
<END COMPRESS>

This code is executed when the user presses the [F4] key
from the RENTAL form.


Line 335 -- When the user presses [F4] from the RENTAL
            table, we call the procedure Form4_Films()
            to switch to the FILMS form.


(See the next page for the listing of the procedure
Form4_Films().)

Line 379 -- A simple MOVETO "FILMS" is all it takes to
            move to the FILMS form, even though it's
            embedded on a different page of the master
            form.

Line 386 -- The WAIT TABLE allows the user to move anywhere
            they want within the FILMS table.

Lines 397-407 -- Before departing from the FILMS table,
                 we need to make sure that the user hasn't
                 left a duplicate key there.

                SWITCHING TO THE FILMS FORM
                        (Continued)



<BEGIN COMPRESS>
ÚÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  Form4.Sc  ³   Proc Form4_Rental()
ÃÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³                                                                                    ³
³ 370  Proc Form4_Films()                                                            ³
³ 371                                                                                ³
³ 372  ;  Processing of the embedded Films table form                                ³
³ 373                                                                                ³
³ 374  Private                                                                       ³
³ 375     wait_key             ;the key the user pressed in response to the Wait     ³
³ 376                                                                                ³
³ 377  ;  Initialization                                                             ³
³ 378                                                                                ³
³ 379  MoveTo "Films"          ;move to the form                                     ³
³ 380  wait_msg = ""           ;no error message yet                                 ³
³ 381                                                                                ³
³ 382  ;  Let the user view and edit the entire table                                ³
³ 383                                                                                ³
³ 384  While True                                                                    ³
³ 385                                                                                ³
³ 386     Wait Table                                                                 ³
³ 387        Prompt "View and edit the films inventory",                             ³
³ 388               "Press [F3] to return to the Rental form"                        ³
³ 389        Message wait_msg                                                        ³
³ 390        Until "F3"                                                              ³
³ 391                                                                                ³
³ 392     wait_key = retval             ;remember the key the user pressed           ³
³ 393     wait_msg = ""                 ;clear the message                           ³
³ 394                                                                                ³
³ 395  ;  Before exiting, test for a key violation                                   ³
³ 396                                                                                ³
³ 397     LockRecord                    ;try to lock the record                      ³
³ 398     If not retval then            ;we couldn't lock it                         ³
³ 399        If errorcode()=53 then     ;a key violation                             ³
³ 400           Beep                                                                 ³
³ 401           wait_msg = "This film # already exists"                              ³
³ 402           MoveTo [Film #]         ;return to the problem field                 ³
³ 403           [] = []                 ;return the problem record to insert status  ³
³ 404           Loop                    ;go back and try again                       ³
³ 405        Endif                                                                   ³
³ 406     Endif                                                                      ³
³ 407     UnlockRecord                  ;unlock the record                           ³
³ 408                                                                                ³
³ 409     QuitLoop                      ;all done                                    ³
³ 410  EndWhile                                                                      ³
³ 411                                                                                ³
³ 412  ;  All done                                                                   ³
³ 413                                                                                ³
³ 414  MoveTo "Rental"                  ;return to the rental table                  ³
³ 415                                                                                ³
³ 416  EndProc                                                                       ³
³                                                                                    ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
<END COMPRESS>


                UPDATING THE FILM INVENTORY


<BEGIN COMPRESS>
ÚÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  Form4.Sc  ³
ÃÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³                                                                                    ³
³ 277        If is_locked_detail then         ;we're inserting a new record          ³
³ 278           Form4_Film_Count(-1)          ;so decrement the film count           ³
³ 279           If not isblank(wait_msg) then ;an error occurred                     ³
³ 280              Loop                       ;so display the error message          ³
³ 281           Endif                                                                ³
³ 282        Endif                                                                   ³
³                                                                                    ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
<END COMPRESS>

This code is performed after the user has entered a new
RENTAL record and the system has validated and locked it.


Line 278 -- The procedure Form4_Film_Count(-1) will
            deduct one from the "# in stock" for the
            current film.  The "-1" means "subtract
            one from the stock count."

Lines 279-281 -- If Form4_Film_Count() encounters an error,
                 it places an error message into the
                 "wait_msg" variable.



<BEGIN COMPRESS>
ÚÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  Form4.Sc  ³
ÃÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³                                                                                    ³
³ 297     If is_del_key then            ;we're deleting a record                     ³
³ 299        If is_locked_detail then         ;we're deleting an existing record     ³
³ 300           Form4_Film_Count(1)           ;so increment film count inventory     ³
³ 301           wait_msg = ""                 ;ignore any error message              ³
³ 302        Endif                                                                   ³
³                                                                                    ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
<END COMPRESS>

This code is performed when the user has pressed the [Del]
key to delete a RENTAL record.

Line 300 -- The procedure Form4_Film_Count(1) will add one
            from the "# in stock" for the current film.     
            The "1" means "add one to the one from the 
            stock count."



                UPDATING THE FILM INVENTORY
                        (Continued)


<BEGIN COMPRESS>
ÚÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  Form4.Sc  ³
ÃÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³                                                                                    ³
³ 423  Proc Form4_Film_Count(n)                                                      ³
³ 424                                                                                ³
³ 425  ;  When a RENTAL record is inserted or deleted, this procedure                ³
³ 426  ;  changes the "# in stock" in the corresponding FILMS record.                ³
³ 427  ;  "N" should be +1 (to add to stock) or -1 (to deduct from stock).           ³
³ 428                                                                                ³
³ 429  ;  Note:  This procedure is pretty lenient about what happens                 ³
³ 430  ;  if it can't find the FILMS record or can't lock it.  I recommend           ³
³ 431  ;  that for real-world applications, you add error-handling code to           ³
³ 432  ;  deal with those situations.                                                ³
³ 433                                                                                ³
³ 434  Private                                                                       ³
³ 435     film_no        ;the film # to update                                       ³
³ 436                                                                                ³
³ 437  ;  Locate the record in the FILMS table                                       ³
³ 438                                                                                ³
³ 439  film_no = [Film #]   ;this is the film # we'll search for                     ³
³ 440  MoveTo "Films"       ;switch to the FILMS table (an unlinked embedded form)   ³
³ 441  MoveTo [Film #]      ;this is the field we'll be searching in                 ³
³ 442  Locate film_no       ;search for the film #                                   ³
³ 443                                                                                ³
³ 444  If retval then       ;we found it                                             ³
³ 445     LockRecord        ;attempt to lock it, so we can change it                 ³
³ 446     If retval then    ;we've successfully locked it                            ³
³ 447        [# in Stock] = [# in Stock] + n     ;adjust the inventory quantity      ³
³ 448        If [# in Stock]<0 then              ;oops!  we've gone negative!        ³
³ 449           wait_msg = "Film # "+film_no+" is out of stock!"   ;error message    ³
³ 450        Endif                                                                   ³
³ 451        UnLockRecord   ;we're done with the record now, so unlock it            ³
³ 452     Endif                                                                      ³
³ 453  Endif                                                                         ³
³ 454                                                                                ³
³ 455  MoveTo "Rental"      ;return to the rental record we originally came from     ³
³ 456                                                                                ³
³ 457  EndProc                                                                       ³
³                                                                                    ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
<END COMPRESS>

This is the procedure that adds or deducts from a film's
"# in stock," when a RENTAL record is being added or 
deleted.



                   CALCULATING SALES TAX


<BEGIN COMPRESS>
ÚÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  Form4.Sc  ³
ÃÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³                                                                                    ³
³ 144  ;  Calculate the sales tax rate                                               ³
³ 145                                                                                ³
³ 146     Form4_Tax_Rate()                                                           ³
³                                                                                    ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
<END COMPRESS>

This procedure is called after the user has edited the
master record in VIDORDER, after the WAIT RECORD.


<BEGIN COMPRESS>
ÚÄÄÄÄÄÄÄÄÄÄÄÄ¿
³  Form4.Sc  ³
ÃÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³                                                                                    ³
³ 464  Proc Form4_Tax_Rate()                                                         ³
³ 465                                                                                ³
³ 466  ;  This procedure calculates the sales tax rate for a Vidorder record         ³
³ 467                                                                                ³
³ 468  Private                                                                       ³
³ 469     store_state,      ;the state where the store is located                    ³
³ 470     customer_state,   ;the state where the customer lives                      ³
³ 471     tax_rate          ;the tax rate from the table                             ³
³ 472                                                                                ³
³ 473  ;  Get the key to the tax rate table                                          ³
³ 474                                                                                ³
³ 475  store_state    = [Store State]                                                ³
³ 476  customer_state = [Customer State]                                             ³
³ 477                                                                                ³
³ 478  ;  Look up the tax rate record                                                ³
³ 479                                                                                ³
³ 480  MoveTo "TaxRate"                    ;move to the table                        ³
³ 481  Locate store_state,customer_state   ;look for the record                      ³
³ 482  If retval then                      ;we found the record                      ³
³ 483     tax_rate = [Sales Tax Rate]      ;so get the tax rate                      ³
³ 484  Else                                ;could not find the record                ³
³ 485     tax_rate = blanknum()            ;so make it blank                         ³
³ 486  Endif                                                                         ³
³ 487                                                                                ³
³ 488  ;  Put the tax rate into the Vidorder record                                  ³
³ 489                                                                                ³
³ 490  MoveTo "Vidorder"             ;return to the Vidorder record                  ³
³ 491  [Sales Tax Rate] = tax_rate   ;fill in the tax rate                           ³
³ 492                                                                                ³
³ 493  ;  All done                                                                   ³
³ 494                                                                                ³
³ 495  EndProc                                                                       ³
³ 496                                                                                ³
³ 497  WriteLib out_lib Form4_Tax_Rate                                               ³
³ 498  Release Procs Form4_Tax_Rate                                                  ³
³                                                                                    ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
<END COMPRESS>

This procedure calculates the sales tax rate, and places it
into the [Sales Tax Rate] field of the VIDORDER record.

                      "SHADOW TABLES"
                   FORM VIDORDER.F5 & F6


<BEGIN COMPRESS>
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±  Add or edit rental line items                                                     ±
±  Press [F2] when done, [F3] to return to master, [F4] to see films                 ±
±  ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ  VIDEO STORE ORDERS ÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»  ±
±  º                                                                              º  ±
±  º     Date: ® 5/05/90    ¯       Customer # ®1776 ¯                            º  ±
±  º     Time: ®10:15A ¯               Store # ®A  ¯                              º  ±
±  º  ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿  º  ±
±  º  ³  Elizabeth Wawrzyczek                 415-359-1992                     ³  º  ±
±  º  ³  669 Aquarius Lane                    Foster City      CA  94404       ³  º  ±
±  º  ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ  º  ±
±  ÌÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍ¹  ±
±  º           ³ Film# ³   Film Title                   ³ Rental Rate ³           º  ±
±  º           ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄ´           º  ±
±  º           ³ A1010 Å Back To The Future             Å  $ 3.00     ³           º  ±
±  º           ³ B1217 Å Casablanca                     Å  $ 2.00     ³           º  ±
±  º           ³ C1210 Å North By Northwest             Å  $ 2.00     ³           º  ±
±  º           ³ A1012Å                                Å  $          ³           º  ±
±  º           ³       Å                                Å  $          ³           º  ±
±  º           ³       Å                                Å  $          ³           º  ±
±  ÌÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍ¹  ±
±  º                                                                              º  ±
±  º                                                                              º  ±
±  º                                                                              º  ±
±  º                                                                              º  ±
±  ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼  ±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±

   
   
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±  View and edit the films inventory                                                 ±
±  Press [F2] to quit, [F3] to return to the master form, [F4] for Payments          ±
±  ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ  VIDEO STORE ORDERS ÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»  ±
±  º                                                                              º  ±
±  º     Date: ® 5/05/90    ¯       Customer # ®1776 ¯                            º  ±
±  º  ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»  º  ±
±  º  º                            FILMS INVENTORY                             º  º  ±
±  º  ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹  º  ±
±  º  º Film #/Title: A1001/It Happened One Night          # of Copies:    20 º  º  ±
±  º  º  Year/Actors: 1934  /C.Gable,C.Colbert              # in Stock:     14 º  º  ±
±  º  º     Category: Classics    Rating: G                 Rental Fee: 2.00   º  º  ±
±  º  ºÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶  º  ±
±  º  º Film #/Title: A1002 /Nine To Five                   # of Copies:    20 º  º  ±
±  º  º  Year/Actors: 1982  /J.Fonda, D.Parton              # in Stock:     18 º  º  ±
±  º  º     Category: Comedy      Rating: PG                Rental Fee: 3.00   º  º  ±
±  º  ºÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶  º  ±
±  º  º Film #/Title: A1003 /Sophie's Choice                # of Copies:    20 º  º  ±
±  º  º  Year/Actors: 1982  /M.Streep,K.Kline               # in Stock:     20 º  º  ±
±  º  º     Category: Drama       Rating: PG                Rental Fee: 3.00   º  º  ±
±  º  ºÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶  º  ±
±  º  º Film #/Title: A1004 /Star Wars                      # of Copies:    20 º  º  ±
±  º  º  Year/Actors: 1977  /M.Hamill,C.Fisher              # in Stock:     19 º  º  ±
±  º  º     Category: Sci-Fi      Rating: PG                Rental Fee: 3.00   º  º  ±
±  º  ºÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶  º  ±
±  ÈÍÍÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼ÍÍ¼  ±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
<END COMPRESS>

                      "SHADOW TABLES"
                        (Continued)   


<BEGIN COMPRESS>
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±  Add or edit payments                                                              ±
±  Press [F2] when done, [F3] to return to master                                    ±
±  ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ  VIDEO STORE ORDERS ÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»  ±
±  º                                                                              º  ±
±  º     Date: ® 5/05/90    ¯       Customer # ®1776 ¯                            º  ±
±  º     Store State: ®CA ¯         Customer State: ®CA ¯                         º  ±
±  º                                                                              º  ±
±  º                  ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿                  º  ±
±  º                  ³       Total Rental Fee:       10.00    ³                  º  ±
±  º                  ³ Sales Tax at   6.5   %:         .65    ³                  º  ±
±  º                  ³            Total Order:       10.65    ³                  º  ±
±  º                  ³            Amount Paid:        7.65    ³                  º  ±
±  º                  ³            Balance Due:        3.00    ³                  º  ±
±  º                  ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ                  º  ±
±  º                         ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»                          º  ±
±  º                         º        PAYMENTS         º                          º  ±
±  º                         ÌÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹                          º  ±
±  º                         º  Method  ³    Amount    º                          º  ±
±  º                         ºÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶                          º  ±
±  º                         º Cash     ³       1.65   º                          º  ±
±  º                         º Visa     ³       6.00   º                          º  ±
±  º                         º         ³              º                          º  ±
±  º                         º          ³              º                          º  ±
±  º                         ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼                          º  ±
±  ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼  ±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
<END COMPRESS>

                      "SHADOW TABLES"
                        (Continued)   


                      FORM VIDORDER.F5

                    ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
                    º     Vidorder     º
                    º                  º
                    º ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ º
                    º ³   Customer   ³ º
                    º ³     M-1      ³ º
                    º ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ º   PAGE 1
                    º ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ º
                    º ³    Rental    ³ º
                    º ³ Multi-Record ³ º
                    º ³     1-M      ³ º
                    º ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ º
                    ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
                    º     Vidorder     º
                    º                  º
                    º ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ º   
                    º ³    Films     ³ º   PAGE 2
                    º ³   Unlinked   ³ º
                    º ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ º
                    º                  º
                    ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

                      "SHADOW TABLES"
                        (Continued)   


                      FORM VIDORDER.F6

                    ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
                    º     Vidorder     º
                    º                  º
                    º ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ º
                    º ³    Amount    ³ º
                    º ³     1-1      ³ º
                    º ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ º
                    º ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ º   PAGE 1
                    º ³   Payment    ³ º
                    º ³ Multi-Record ³ º
                    º ³     1-M      ³ º
                    º ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ º
                    º ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ º
                    º ³   TaxRate    ³ º
                    º ³   Unlinked   ³ º
                    º ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ º
                    º                  º
                    ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
                    º     Vidorder     º
                    º                  º
                    º ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ º
                    º ³    Store     ³ º
                    º ³ Multi-Record ³ º
                    º ³     M-1      ³ º   PAGE 2
                    º ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ º
                    º ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ º
                    º ³   Employee   ³ º
                    º ³     M-M      ³ º
                    º ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ º
                    º                  º
                    ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼


                   HOW SHADOW TABLES WORK


VIDORDER.DB

ÿÄÄÄÄÄÂÄÄÄÄÄÂÄÄÄÄÄÂÄÄÄÄÄÂÄÄÄÄÄÿ
ÿ     ³     ³     ³     ³     ÿ
ÿÄÄÄÄÄÅÄÄÄÄÄÅÄÄÄÄÄÅÄÄÄÄÄÅÄÄÄÄÄÿ    
ÿ     ³     ³     ³     ³     ÿ   - Remains in table-view
ÿÄÄÄÄÄÅÄÄÄÄÄÅÄÄÄÄÄÅÄÄÄÄÄÅÄÄÄÄÄÿ   - Selected record is 
ÿ     ³     ³     ³     ³     ÿ     locked
ÿÄÄÄÄÄÅÄÄÄÄÄÅÄÄÄÄÄÅÄÄÄÄÄÅÄÄÄÄÄÿ
ÿ     ³     ³     ³     ³     ÿ
ÿÄÄÄÄÄÅÄÄÄÄÄÅÄÄÄÄÄÅÄÄÄÄÄÅÄÄÄÄÄÿ
ÿ     ³     ³     ³     ³     ÿ
ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ
               ^
               ³                  - CopyToArray & 
               ³                    CopyFromArray
               ³                    to transfer records 
               ³                    between master and
               v                    shadows

         VIDORD1.DB               The First SHADOW Table
    ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
    ³      FORM.F5     ³          - Same structure as 
    ³                  ³            VIDORDER.DB
    ³                  ³          - Unkeyed
    ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´          - Displays the .F5 form
    ³                  ³
    ³                  ³
    ³                  ³
    ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

            ^
            ³                     - CopyToArray &
            ³                       CopyFromArray
            ³
            ³
            v

         VIDORD2.DB        
    ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
    ³      FORM.F6     ³          The Second SHADOW Table
    ³                  ³   
    ³                  ³          - Same structure as   
    ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´            VIDORDER.DB
    ³                  ³          - Unkeyed
    ³                  ³          - Displays the .F6 form
    ³                  ³
    ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

                  BENEFITS OF SHADOW TABLES



o  Overcome the five-embedded tables limit


o  Allow more elaborate forms

   -  Shadow form can have "throw-away" fields not
      kept in the master table structure


o  Avoid Form Locks

   -  The master table remains in table view

   -  The shadow tables are unkeyed, so no form locks



Warning:  By using shadow tables to avoid form locks, you
          are also bypassing Paradox's "referential
          integrity" features.  Among other things, this 
          means that other users on the network can edit
          the same group of records that you are.


















=====================================================================
END OF DOCUMENT
=====================================================================



